rz.widgets.RZTableWidgetHelpers={TableWidgetInterface:[{name:"addRows",description:"Adiciona uma ou mais linhas à tabela",friendlyName:"Adicionar linhas",params:[{name:"rowData",friendlyName:"Dados da nova linha",description:"Objeto ou coleção de objetos que serão adicionados à tabela na forma de linhas (ver especificação)",type:"any"}]},{name:"insertRows",friendlyName:"Inserir linhas",description:"Insere uma ou mais linhas em uma posição na tabela",params:[{name:"position",friendlyName:"Linha",description:"Posição onde a(s) linha(s) será(ão) inserida(s)",type:"int"},{name:"rowData",friendlyName:"Dados das novas linhas",description:"Objeto ou coleção de objetos que serão adicionados à tabela na forma de linhas (ver especificação)",type:"any"}]},{name:"getRowData",friendlyName:"Obter dados da linha",description:"Recupera o objeto de dados associado a uma linha da tabela",params:[{name:"rowIndex",friendlyName:"Linha",description:"Posição da linha da qual se quer obter os dados",type:"int"}]},{name:"clear",friendlyName:"Limpar",description:"Limpa todos os dados da tabela"},{name:"changeCellData",friendlyName:"Alterar dados de célula",description:"Altera os dados de uma célula e renderiza-a",params:[{name:"position",friendlyName:"Linha",description:"Posição da linha da qual se quer alterar os dados",type:"int"},{name:"cellName",friendlyName:"Nome da célula",description:"nome da propriedade que será alterada",type:"string"},{name:"newValue",friendlyName:"Valor",description:"Novo valor da célula",type:"any"}]},{name:"sort",friendlyName:"Ordenar",description:"Ordena os dados da tabela",params:[{name:"sortParams",friendlyName:"Opções de ordenação",description:"Parâmetros utilizados na ordenação da tabela",type:"object"}]},{name:"filter",friendlyName:"Filtrar",description:"Filtra os dados de acordo com uma expressão de filtro",params:[{name:"filterExpression",friendlyName:"Expressão de filtro",description:"Expressão utilizada para filtragem dos dados",type:"object"}]},{name:"find",friendlyName:"Procurar",description:"Executa uma pesquisa arbitrária de dados",params:[{name:"searchKey",friendlyName:"Chave da busca",description:"Chave da pesquisa de dados",type:"any"}]},{name:"gotoPage",friendlyName:"Ir para página",description:"Navega para uma página de dados específica",params:[{name:"page",friendlyName:"Página",description:"Página",type:"object"}]},{name:"refresh",friendlyName:"Atualizar",description:"Atualiza o conteúdo da página"}]},rz.widgets.tableHelpers={cellRenderers:{},createCellRenderer:function(n,d){this.cellRenderers[n]=d},getCellRenderer:function(n){return"string"==typeof n?this.cellRenderers[n]||this.cellRenderers["default"]:n},sizeNames:["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fiveteen","sixteen"]},rz.widgets.RZTableWidgetHelpers.renderingHelpers=function(t){var $this=t,that=this;this.hasFooter=function(){return $this.params.paging.enablePaging},this.renderTableStructure=function(target,renderRowsMethod){var sb=new StringBuilder;sb.appendFormat('<table id="{1}" class="rz-table-widget {0}">',$this.params.ui.tableClass,$this.params.ui.elementID),that.renderTableHeader(sb),sb.append("<tbody></tbody>"),($this.params.paging.enablePaging||$this.params.ui.displayTableFooter)&&that.renderTableFooter(sb),sb.appendFormat("</table>"),$("#"+target).html(sb.toString()),void 0!==$this.params.columns&&$this.setupHelpers.setupSorting(),renderRowsMethod()},this.renderTableHeader=function(sb){$this.params.ui.renderTableHead&&(sb.append("<thead>"),that.renderTableHeaderContent(sb),sb.append("</thead>"))},this.renderTableHeaderContent=function(sb){if(void 0!==$this.params.columns){var plot=!1;void 0==sb&&(plot=!0,sb=new StringBuilder),sb.append("<tr>"),$this.params.columns.forEach(function(col){sb.appendFormat('<th{0} data-bindingsource="{1}">',$this.internals.resolveHeaderClass(col),col.bindingSource||"");var renderer=rz.widgets.tableHelpers.getCellRenderer(col.headerRender||"default"),value=col.headerText||col.bindingSource;sb.append(renderer(value,col)),sb.append("</th>")}),sb.append("</tr>"),plot&&($("#"+$this.params.ui.elementID+" thead").html(sb.toString()),$this.setupHelpers.setupSorting())}},this.renderTableRows=function(){$this.runtimeHelpers.getRows(function(data){if($this.internals.isEmptyResult(data))that.renderEmptyDataRow(),that.removePagingToolBox();else{var ds=$this.internals.ensureDataSource(data);$this.params.paging.currentPage=ds.header.currentPage,$this.params.paging.totalPages=ds.header.totalPages,$this.rowsData=ds.rows;var defined=$this.setupHelpers.ensureColumns(void 0!==$this.rowsData&&$this.rowsData.length>0?$this.rowsData[0]:void 0);(defined||$this.recreateFromOriginalDefinition)&&(that.renderTableHeaderContent(),$this.recreateFromOriginalDefinition=!1),that.renderAndPlotRows(),that.renderPagingToolBox()}$this.runtimeHelpers.executePostRenderScripts()})},this.renderAndPlotRows=function(isPostAddedRow,rowsSource,preserveActualRows,position){var rows=rowsSource||$this.rowsData,sb=new StringBuilder;rows.forEach(function(it,rowIndex){it.__uid=generateRandomID(16),sb.appendFormat('<tr{0} data-refid="{1}">',isPostAddedRow?' class="'+$this.params.ui.addedAfterRowClass+'"':"",it.__uid),$this.params.columns.forEach(function(col){sb.appendFormat("<td{0}>",$this.internals.resolveTDClass(col)),$this.internals.renderCellData($this,it,col,sb,rowIndex),sb.appendFormat("</td>")}),sb.appendFormat("</tr>")}),$this.internals.plotOnBody(sb,"#"+$this.params.ui.elementID,preserveActualRows,position)},this.renderTableFooter=function(sb){that.hasFooter()&&sb.appendFormat('<tfoot><tr><td colspan="6000"></td></tr></tfoot>')},this.removePagingToolBox=function(){var pagingToolboxID="#"+$this.params.ui.elementID+"_paging_toolbox";$(pagingToolboxID).remove()},this.renderPagingToolBox=function(){if($this.params.paging.enablePaging){var pagingToolboxID=$this.params.ui.elementID+"_paging_toolbox";if(1==$("#"+pagingToolboxID).length){var piid="#@_paginginput".replace("@",$this.params.ui.elementID),tpid="#@_total_pages_el".replace("@",$this.params.ui.elementID);$(piid).val($this.params.paging.currentPage),$(tpid).html($this.params.paging.totalPages)}else{var sb=new StringBuilder;sb.appendFormat('<div id="{0}" class="ui right floated pagination menu rz-pagination-bar">',pagingToolboxID),sb.appendFormat('    <div>{0} </div><input id="{4}_paginginput" type="text" class="paging-input" value="{2}" data-paging-action="specific"> <span>{1}</span> <span id="{4}_total_pages_el">{3}</span>',$this.params.language.paginate.page,$this.params.language.paginate.of,$this.params.paging.currentPage,$this.params.paging.totalPages,$this.params.ui.elementID),sb.appendFormat('    <a class="icon item {1}-paging-button" title="{0}" data-paging-action="first"><i class="double angle left icon"></i></a>',$this.params.language.paginate.first,$this.params.ui.elementID),sb.appendFormat('    <a class="icon item {1}-paging-button" title="{0}" data-paging-action="previous"><i class="angle left icon"></i></a>',$this.params.language.paginate.previous,$this.params.ui.elementID),sb.appendFormat('    <a class="icon item {1}-paging-button" title="{0}" data-paging-action="next"><i class="angle right icon"></i></a>',$this.params.language.paginate.next,$this.params.ui.elementID),sb.appendFormat('    <a class="icon item {1}-paging-button" title="{0}" data-paging-action="last"><i class="double angle right icon"></i></a>',$this.params.language.paginate.last,$this.params.ui.elementID),sb.appendFormat("</div>"),$("#"+$this.params.ui.elementID+" tfoot > tr > td").html(sb.toString()),$this.setupHelpers.setupPaging()}}},this.renderEmptyDataRow=function(){if($this.params.ui.displayEmptyMessage){var sb=new StringBuilder;void 0!==$this.params.columns?$this.params.columns.length||1:1;sb.appendFormat('<tr class="empty-row"><td colspan="6000">{0}</td></tr>',$this.params.ui.emptyMessageRenderer($this.params.language.emptyTableMessage)),$this.internals.plotOnBody(sb,"#"+$this.params.ui.elementID)}},this.renderErrorDataRow=function(){var sb=new StringBuilder;void 0!==$this.params.columns?$this.params.columns.length||1:1;sb.appendFormat('<tr class="error-row"><td colspan="60000">{0}</td></tr>',$this.params.ui.errorMessageRenderer($this.params.language.errorGettingDataMessage)),$this.internals.plotOnBody(sb,"#"+$this.params.ui.elementID)},this.emptyMessageRendererFunction=function(message){return"<h1>*</h1>".replace("*",message)},this.errorMessageRendererFunction=function(){return'<div class="error-message">error getting server data</div>'},this.removeEmptyDataRow=function(){$(".empty-row").detach()},this.removeErrorRow=function(){$(".error-row").detach()},this.removeAfterAddedRowsClass=function(){setTimeout(function(){$("#"+$this.params.ui.elementID+" tbody > tr").removeClass("added-after-row")},500)},this.renderChangedCell=function(cInfo,rd,position){var row=$("#"+$this.params.ui.elementID+" tbody > tr")[position],sb=new StringBuilder;$this.internals.renderCellData($this,rd,cInfo.cellData,sb,position),$($(row).children("td")[cInfo.index]).html(sb.toString());var tTd=$($(row).children("td")[cInfo.index]);tTd.removeClass("changed-cell-1"),tTd.addClass("changed-cell-1"),setTimeout(function(){tTd.removeClass("changed-cell-1")},500)},this.renderSortingIndicator=function(column,sortDir){var isAscending="desc"!=sortDir,cssClass=isAscending?"sorted ascending":"sorted descending";$("#"+$this.params.ui.elementID+" th").removeClass("sorted ascending descending"),$("#"+$this.params.ui.elementID+' th[data-bindingsource="'+column+'"]').addClass(cssClass)}},rz.widgets.RZTableWidgetHelpers.setupHelpers=function(t){var $this=t;this.ensureColumns=function(dataRow){if(void 0===$this.params.columns){var keys=Object.keys(dataRow);return $this.params.columns=[],keys.forEach(function(it){var columnDefinition={bindingSource:it,renderer:"text"};$this.params.columns.push(columnDefinition)}),!0}return!1},this.setupSorting=function(){$this.params.ui.allowSorting&&($("#"+$this.params.ui.elementID).addClass("sortable"),$("#"+$this.params.ui.elementID+" th").click(function(e){var el=$(e.currentTarget),bs=el.data("bindingsource");if(!el.hasClass("unsortable")){var isAscending=el.hasClass("sorted ascending"),sortOrder=isAscending?"desc":"asc";$this.renderingHelpers.renderSortingIndicator(bs,sortOrder),""!=bs&&($this.sorting.sortCol=bs,$this.sorting.sortDir=isAscending?"desc":"asc",$this.params.paging.currentPage=1,$this.renderingHelpers.renderTableRows())}}))},this.setupPaging=function(){var baseid=$this.params.ui.elementID,inputID="#"+baseid+"_paginginput",btCL="."+baseid+"-paging-button",doPagingAction=function(src){var action=$(src.currentTarget).data("paging-action");switch(action){case"first":case"previous":case"next":case"last":$this.gotoPage(action);break;case"specific":$this.gotoPage($(inputID).val())}};$(btCL).click(doPagingAction),$(inputID).keyup(function(e){13==e.keyCode&&doPagingAction(e)})}},rz.widgets.RZTableWidgetHelpers.runtimeHelpers=function(t){var $this=t;this.getRows=function(callback){var getDataCallback=function(result,status,info){"error"==status?(console.error("error getting table rows with:","result: ",result,"info: ",info),$this.renderingHelpers.renderErrorDataRow()):callback(result)};if(void 0!==$this.params.tableData.dataSource){var dsType=typeof $this.params.tableData.dataSource;if("function"==dsType){var p={paging:$this.params.paging,filter:$this.filterExpression,sorting:$this.sorting};$this.params.tableData.dataSource(p,getDataCallback)}else if("string"==dsType){var url=$this.params.tableData.dataSource;url=rz.utils.uri.mergeParam(url,"paging",$this.params.paging.enablePaging),url=rz.utils.uri.mergeParam(url,"curpage",$this.params.paging.currentPage),url=rz.utils.uri.mergeParam(url,"psize",$this.params.paging.pageSize),url=rz.utils.uri.mergeParam(url,"sortcol",$this.sorting.sortCol),url=rz.utils.uri.mergeParam(url,"sortdir",$this.sorting.sortDir),url=rz.utils.uri.mergeParam(url,"filter",btoa(JSON.stringify($this.filterExpression))),ruteZangada.get(url,getDataCallback)}else console.error("invalid data source type: ",dsType),$this.renderingHelpers.renderErrorDataRow()}else $this.renderingHelpers.renderEmptyDataRow()},this.enqueuePostRenderScript=function(f){$this.postRenderScripts.push(f)},this.executePostRenderScripts=function(){$this.postRenderScripts.forEach(function(it){try{it($this)}catch(err){console.error("error running postRenderScript","error:",err,"sender:",$this,"script:",it)}}),$this.postRenderScripts=[]},this.getColumnInfo=function(cellName){var info={};return info.index=$this.params.columns.findIndex(function(element,index,array){var result=element.bindingSource==cellName;return result&&(info.cellData=element),result}),info}},rz.widgets.RZTableWidgetHelpers.Internals={resolveHeaderClass:function(col){var classData="";void 0!==col.size&&(classData+=rz.widgets.tableHelpers.sizeNames[col.size]+" wide ");var align=col.headerAlignment||col.alignment||"left";return"left"!=align&&(classData+=align+" aligned "),void 0===col.sortable&&(col.sortable=!0),col.sortable||(classData+=" unsortable "),""!=classData?' class="'+classData+'"':""},plotOnBody:function(sb,target,preserve,position){preserve?void 0===position?$(target+" tbody").append(sb.toString()):$(target+" tbody > tr").eq(position).before(sb.toString()):($(target+" tbody").empty(),$(target+" tbody").html(sb.toString()))},getServerData:function(target,params){ruteZangada.get(params.rowsData,function(d,r){if("success"==r){var url=params.rowsData;params.rowsData=d,params.sourceURL=url,renderRowsData(target,params,hasColumnDefinitions)}else $("#"+params.elementID).append(params.errorMessageRenderer())})},isEmptyResult:function(r){return!(void 0!==r&&(r.length>0||void 0!==r.rows&&r.rows.length>0))},ensureDataSource:function(dataRows){return void 0!==dataRows.header&&void 0!==dataRows.rows?dataRows:{header:{currentPage:1,totalPages:1,sortColumn:"",sortDir:""},rows:dataRows}},resolveTDClass:function(col){var classData="";return void 0!==col.alignment&&"left"!=col.alignment&&(classData+=col.alignment+" aligned "),""!=classData?' class="'+classData+'"':""},renderCellData:function($this,rowData,colData,sb,rowIndex){var renderer=rz.widgets.tableHelpers.getCellRenderer(colData.cellRenderer||"default");sb.append(renderer(rowData[colData.bindingSource],rowData,colData,$this,rowIndex))}},rz.widgets.tableHelpers.createCellRenderer("actions-renderer",function(value,full,columnDef,targetInstance){var sb=new StringBuilder;return sb.appendFormat('<div id="{1}-{0}" class="ui icon top right basic pointing dropdown button table-actions-button" data-rowref="{0}">',full.__uid,targetInstance.params.ui.elementID),sb.append('  <i class="ellipsis vertical icon"></i>'),sb.append('  <div class="menu">'),columnDef.actions.forEach(function(it){sb.appendFormat('    <div class="item" data-value="{1}">{0}</div>',it.label,it.action)}),sb.append("  </div>"),sb.append("</div>"),targetInstance.runtimeHelpers.enqueuePostRenderScript(function(){var selector1="#"+targetInstance.params.ui.elementID+"-"+full.__uid;$(selector1).dropdown({action:"hide",onChange:function(action){var rowRef=$(this).data("rowref"),rowData=targetInstance.rowsData.find(function(it){return it.__uid==rowRef});columnDef.clickHandler(action,rowData,rowRef)}})}),sb.toString()}),rz.widgets.tableHelpers.createCellRenderer("default",function(value){return value}),rz.widgets.TableWidget=ruteZangada.widget("rz-table",rz.widgets.RZTableWidgetHelpers.TableWidgetInterface,[],function(){var $this=this;$this.sorting={sortCol:"",sortDir:""},$this.filterExpression=void 0,$this.postRenderScripts=[],$this.internals=rz.widgets.RZTableWidgetHelpers.Internals,$this.renderingHelpers=new rz.widgets.RZTableWidgetHelpers.renderingHelpers($this),$this.setupHelpers=new rz.widgets.RZTableWidgetHelpers.setupHelpers($this),$this.runtimeHelpers=new rz.widgets.RZTableWidgetHelpers.runtimeHelpers($this),this.initialize=function(p,initialized){var elementID=generateRandomID(8),defaultParams={tableData:{dataSource:void 0},columns:void 0,ui:{tableClass:"ui basic table",renderTableHead:!0,elementID:elementID,allowSorting:!0,addedAfterRowClass:"added-after-row",displayEmptyMessage:!0,displayTableFooter:!1,emptyMessageRenderer:$this.renderingHelpers.emptyMessageRendererFunction,errorMessageRenderer:$this.renderingHelpers.errorMessageRendererFunction},language:{paginate:{page:"Page",of:"of",first:"first",previous:"previous",next:"next",last:"last"},emptyTableMessage:"no data to display",errorGettingDataMessage:"error getting table data"},paging:{enablePaging:!1,pageSize:20,currentPage:1}};$this.params=$.extend(!0,{},defaultParams,p),initialized()},this.render=function(target){$this.renderingHelpers.renderTableStructure(target,$this.renderingHelpers.renderTableRows)},this.sort=function(column,direction){direction=direction||"asc",$this.sorting={sortCol:column,sortDir:direction},$this.params.paging.currentPage=1,$this.renderingHelpers.renderSortingIndicator(column,direction),$this.refresh()},this.gotoPage=function(page){var totalPages=$this.params.paging.totalPages,ensureValidPage=function(pg){var n=parseInt(pg);return isNaN(n)?1:1>n?1:n>totalPages?totalPages:n},currentPage=$this.params.paging.currentPage;switch(page){case"f":case"first":$this.params.paging.currentPage=1;break;case"p":case"previous":$this.params.paging.currentPage=ensureValidPage($this.params.paging.currentPage-1);break;case"n":case"next":$this.params.paging.currentPage=ensureValidPage($this.params.paging.currentPage+1);break;case"l":case"last":$this.params.paging.currentPage=totalPages;break;default:$this.params.paging.currentPage=ensureValidPage(page)}currentPage!==$this.params.paging.currentPage&&$this.renderingHelpers.renderTableRows()},this.getRowData=function(position){var r=(parseInt(position),$("#"+$this.params.ui.elementID+" tbody > tr")[position]);if(void 0!==r){var refid=$(r).data("refid");return void 0!==refid?void 0===$this.rowsData?void 0:$this.rowsData.find(function(i){return i.__uid==refid}):void 0}},this.getRowCount=function(){return $("#"+this.params.ui.elementID+" tbody > tr").length},this.clear=function(removeColumns,removeColumnDefinitions){$("#"+$this.params.ui.elementID+" tbody").empty(),$("#"+$this.params.ui.elementID+" thead th").removeClass("sorted"),$this.renderingHelpers.removePagingToolBox(),$this.params.ui.displayEmptyMessage&&$this.renderingHelpers.renderEmptyDataRow(),$this.params.paging.currentPage=1,$this.sorting={sortCol:"",sortDir:""},$this.rowsData=[],removeColumns&&($("#"+$this.params.ui.elementID+" thead").empty(),removeColumnDefinitions?$this.params.columns=void 0:$this.recreateFromOriginalDefinition=!0)},this.refresh=function(){$this.renderingHelpers.renderTableRows()},this.addRows=function(rowData){this.insertRows(-1,rowData)},this.insertRows=function(position,rowData){(void 0===position||0>position||position>=$this.getRowCount())&&(position=void 0),void 0!==rowData&&(void 0===rowData.length&&(rowData=[rowData]),$this.rowsData=$this.rowsData.concat(rowData),$this.renderingHelpers.renderAndPlotRows(!0,rowData,!0,position),$this.runtimeHelpers.executePostRenderScripts(),$this.renderingHelpers.removeEmptyDataRow(),$this.renderingHelpers.removeErrorRow(),$this.renderingHelpers.removeAfterAddedRowsClass())},this.changeCellData=function(position,cellName,newValue){if(!(position>=0&&position<$this.getRowCount()))throw"INVALID POSITION";var rd=$this.getRowData([position]);rd[cellName]=newValue;var cInfo=$this.runtimeHelpers.getColumnInfo(cellName);if(-1==cInfo.index)throw"INVALID CELL";$this.renderingHelpers.renderChangedCell(cInfo,rd,position)},this.filter=function(filterExpression){$this.filterExpression=filterExpression,$this.params.paging.currentPage=1,$this.refresh()},this.find=function(searchKey){$this.filterExpression={format:"simple-search",searchKey:searchKey},$this.params.paging.currentPage=1,$this.refresh()}});